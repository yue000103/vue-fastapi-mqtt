# 实时数据采集系统开发文档

## 项目概述
基于Vue + FastAPI + MQTT的实时数据采集和可视化系统，实现后端持续生成随机数据，前端实时接收并绘制时间序列图表。

## 系统架构

### 技术栈
- **前端**: Vue 3 + Chart.js/ECharts (图表库)
- **后端**: FastAPI + Python
- **消息队列**: MQTT Broker (如 Mosquitto)
- **数据传输**: MQTT

### 架构图
```
[Vue前端] <--MQTT--> [MQTT Broker] <--MQTT--> [FastAPI后端]
    |                                               |
[图表展示]                                    [随机数生成器]
[控制按钮]                                    [数据发布器]
```

## 功能需求

### 后端功能 (FastAPI)
1. **数据生成器**
   - 每秒生成一个随机数 (0-100)
   - 持续运行，不受前端控制影响
   - 数据格式: `{"timestamp": "2025-09-12T10:30:45", "value": 85.6}`

2. **MQTT发布器**
   - 连接到MQTT Broker
   - 发布数据到主题: `data/random`
   - 保持连接稳定性

### 前端功能 (Vue)
1. **实时图表**
   - X轴: 时间 (HH:mm:ss)
   - Y轴: 数值 (0-100)
   - 实时更新，保持最近5分钟数据
   - 平滑的动画效果

2. **控制按钮**
   - **开始**: 连接MQTT并开始接收和显示数据
   - **暂停**: 暂停图表更新 (后端继续生成，前端暂停接收)
   - **继续**: 恢复图表更新和数据接收
   - **重新开始**: 清空图表数据，重新开始

3. **MQTT客户端**
   - 连接到MQTT Broker
   - 订阅主题: `data/random`
   - 处理连接断开重连

## 技术实现

### 后端实现 (FastAPI)
```python
# 主要组件
1. main.py - FastAPI应用入口
2. mqtt_client.py - MQTT客户端
3. data_generator.py - 随机数生成器
```

### 前端实现 (Vue)
```javascript
// 主要组件
1. App.vue - 主应用组件
2. components/DataChart.vue - 图表组件
3. components/ControlPanel.vue - 控制面板
4. services/mqtt.js - MQTT客户端服务
```

### MQTT主题设计
- `data/random` - 随机数据发布
- `system/status` - 系统状态 (可选)

## 数据流程
1. 后端定时器每秒生成随机数
2. 随机数通过MQTT发布到Broker
3. 前端MQTT客户端订阅并接收实时数据
4. 前端根据按钮状态决定是否更新图表

## 部署要求

### 开发环境
- Python 3.8+
- Node.js 16+
- MQTT Broker (Mosquitto)

### 端口配置
- FastAPI: 8000
- Vue Dev Server: 3000
- MQTT Broker: 1883 (TCP), 9001 (WebSocket)

## 项目结构
```
vue-fastapi-mqtt/
├── backend/
│   ├── main.py
│   ├── mqtt_client.py
│   ├── data_generator.py
│   └── requirements.txt
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   ├── services/
│   │   └── App.vue
│   ├── package.json
│   └── vite.config.js
├── docker-compose.yml (MQTT Broker)
└── README.md
```

## 核心特性
1. **实时性**: 1秒延迟内的数据展示
2. **稳定性**: 支持断线重连
3. **用户体验**: 流畅的图表动画和响应式控制
4. **数据持久**: 前端保持5分钟历史数据
5. **解耦设计**: 前端控制不影响后端数据生成

## 后续扩展
- 数据持久化 (数据库存储)
- 多数据源支持
- 历史数据查询
- 数据导出功能
- 用户认证与权限

---
*此文档概述了系统的整体设计，具体实现细节将在开发过程中进一步完善。*