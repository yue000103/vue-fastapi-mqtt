# 硬件接口文档

## 系统架构图

![系统架构图](img_1.png)

---

## 主机模块（通过树莓派通信）

### 继电器
**文件**: [`relay_base.py`](host/relay_base.py)

| 名称 | 参数 | 控制对象 |
|------|------|----------|
| 双2  | 1    | 低压电磁阀 |
| 双1  | 2    | 高压电磁阀 |
| 泵2  | 3    | 气泵 |

### 压力传感器
**文件**: [`press_sensor.py`](host/press_sensor.py)  
**接口**: ttyAMA0  
**波特率**: 9600

### 检测器
**文件**: [`ecom_pcb.py`](host/ecom_pcb.py)  
**接口**: ttyAMA3  
**波特率**: 57600

### 四合一高压恒流泵
**文件**: [`FLISHS.py`](host/FLISHS.py)  
**接口**: ttyAMA2  
**波特率**: 115200

### 气泡传感器
**文件**: [`bubble_sensor.py`](host/bubble_sensor.py)

| 名称 | 参数 | 控制对象 |
|------|------|----------|
| 气1  | 1    | 1号气泡传感器 |
| 气2  | 2    | 2号气泡传感器 |
| 气3  | 3    | 4号气泡传感器 |
| 气4  | 4    | 3号气泡传感器 |

![气泡传感器图](img_2.png)

---

## 收集模块（通过ip地址通信）

### LED灯控制
**文件**: [`indicator_light.py`](collect/indicator_light.py)  
**接口URL**: `http://192.168.1.129/led/on`

**请求数据格式**:
```json
{
    "group0": [
        {
            "led_num": 1,
            "color": [255, 0, 0]  // 红色
        },
        {
            "led_num": 2,
            "color": [0, 255, 0]  // 绿色
        }
    ],
    "group1": [
        {
            "led_num": 1,
            "color": "#0000FF"  // 蓝色
        },
        {
            "led_num": 3,
            "color": "0xFFFF00"  // 黄色
        }
    ]
}
```

### 空气泵、电磁阀控制
**文件**: [`single_valve.py`](collect/single_valve.py)  
**接口URL**: `http://192.168.1.129/device/on?pin_num=8&value=0`

**参数说明**:
- `pin_num`: 引脚编号（左边 0-7，右边 8-15）
- `value`: 0关闭，1开启

**设备配置**:

| 名称 | 类型 | pin_num |
|------|------|---------|
| 电5  | 二通阀 | 9 |
| 电6  | 二通阀 | 8 |
| 电2  | 电磁阀 | 10 |
| 电3  | 电磁阀 | 11 |
| 电4  | 电磁阀 | 12 |
| 电1  | 电磁阀 | 13 |
| 泵3  | 电磁阀 | 14 |
| 双3  | 备用  | 15 |

### 气泡传感器状态读取
**文件**: [`qipao.py`](collect/qipao.py)  
**接口URL**: `http://192.168.1.129/device/data`

**返回数据说明**:
- 返回8位数据（如：11110001）
- 最后三位表示3个气泡传感器的开关状态
- 111：全亮，000：全暗

**传感器状态对照**:

| 名称 | 检测到液体时返回值 |
|------|-------------------|
| 气5  | 11110100 |
| 气6  | 11110010 |
| 气7  | 11110001 |

### 多向阀控制
**文件**: [`multi_valve.py`](collect/multi_valve.py)  
**接口URL**: `http://192.168.1.129/valve/switch?num=4&valve_num=10`

**参数说明**:
- `valve_num`: 多向阀编号（1-11）
- `num`: 通道号（0表示复位，1-10表示通道）

**阀站配置**:

| 名称 | 阀站号 |
|------|--------|
| 多1  | 9 |
| 多2  | 4 |
| 多3  | 2 |
| 多4  | 1 |
| 多5  | 2 |
| 多6  | 11 (0B) |
| 多7  | 10 (0A) |
| 多8  | 7 |
| 多9  | 8 |
| 多10 | 5 |
| 多11 | 6 |

### 隔膜泵控制
**文件**: [`spray_pump.py`](collect/spray_pump.py)  
**接口URL**: `http://192.168.1.129/pump/switch?ifon=1&freq=1000&duty=1000`

**参数说明**:
- `ifon`: 开关（0关闭，1开启）
- `freq`: 频率
- `duty`: 速度

**设备名称**: 泵4

